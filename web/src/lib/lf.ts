// src/lib/lf.ts
import type { Label } from "./rules";

export type LF = {
  name: string;         // ä¸€æ„åï¼ˆweights.jsonã®ã‚­ãƒ¼ã«ãªã‚‹ï¼‰
  label: Label;         // ã“ã®LFãŒè²¢çŒ®ã™ã‚‹ãƒ©ãƒ™ãƒ«
  apply: (text: string) => number; // 0ã€œ1ï¼ˆãƒ’ãƒƒãƒˆãªã‚‰1.0ã€å¼±ãƒ’ãƒƒãƒˆãªã‚‰0.3ç­‰ã‚‚OKï¼‰
};

// ã–ã£ãã‚Šãªæ—¥æœ¬èªžå‘ã‘REï¼ˆå¿…è¦ã«å¿œã˜ã¦æ‹¡å¼µï¼‰
const RE = {
  agree: /(è³›æˆ|åŒæ„|åŒæ„Ÿ|äº†è§£|ã‚ã‹ã‚‹|ãã‚Œãª|ãã‚Œã¯ãã†|ãŸã—ã‹ã«|ç¢ºã‹ã«|OK|ã„ã„ã­|ãã®é€šã‚Š|åŠ©ã‹ã‚‹)/i,
  emotion: /(å¬‰ã—ã„|æ¥½ã—ã„|æ‚²ã—ã„|ç–²ã‚ŒãŸ|ã‚„ã°ã„|æœ€é«˜|æœ€ä½Ž|è‰|ç¬‘|ï½—|w|ï¼{2,}|!{2,})/i,
  laughOnly: /^\s*(?:w|ï½—)+\s*$/i,
  praise: /(ã‚„ã‚Šã¾ã™ã­ã‡?|ã‚„ã‚‹ã˜ã‚ƒã‚“|ã•ã™ãŒ|ã™ã”ã„|å‡„ã„|ãƒŠã‚¤ã‚¹|nice|gj|ã‚°ãƒƒã‚¸ãƒ§ãƒ–|bravo|æ‹æ‰‹|ã±ã¡ã±ã¡|ðŸ‘|ä¸Šæ‰‹ã„|ã†ã¾ã„|ä¸Šå‡ºæ¥|ãŠè¦‹äº‹|ç¥žã£ã¦ã‚‹|ç¥ž|å¤©æ‰|ãˆã‚‰ã„)/i,
  chit: /(ã¯ãˆã‡|ãªã‚‹ã»ã©|ãŠã¤ã‹ã‚Œ|ãµã‚€|ã¸ã‡|ãŸã¶ã‚“|ã‹ã‚‚|ç¬‘)/i,
  chitHead: /^(ã„ã‚„|ã„ã‚„ãƒ¼|ã„ã‚„ã?|ã¾ã|ã¾ã˜ã§|ã»ã‚“ã¨ã«|ãã‚Œã¯|ãŸã—ã‹ã«|ã†ãƒ¼ã‚“|ãˆãƒ¼ã¨|ãŠãŠ|ã¸ãˆ|ãµãƒ¼ã‚€)/i,
  question: /[?ï¼Ÿ]\s*$/i,
  jaQuestionHints: /(ãªã‚“ã§|ãªã‚“ã ã‚ã†|ã ã‚ã†ã‹|ã‹ãªã?|ã‹ã—ã‚‰|ã©ã†ã‹ãª|ã©ã†ã ã‚ã†|æ•™ãˆã¦|çŸ¥ã‚ŠãŸã„|åˆ†ã‹ã‚‰ã‚“|ã‚ã‹ã‚‰ã‚“|ã£ã¦ã§ãã‚‹ã£ã‘|ã§ãã‚‹ã£ã‘|ãªã„ã‚“ã ã£ã‘ã‹|ã ã£ã‘ã‹|ã£ã‘\??)\s*$/i,
  kansaiQ: /(?:ãªã‚“ã§ã‚„ã­ã‚“|ãªã‚“ã‚„ã­ã‚“)(?:[!ï¼?ï¼Ÿ]*\s*(?:w|ï½—)*)?\s*$/i,
  neg: /[ðŸ™…ðŸš«âŒâœ–âœ•]|(ãã‚Œã¯|ãã‚Šã‚ƒ|æµçŸ³ã«)?\s*(ãªã—|ç„¡ã—|ãªã„|ç„¡ã„)\s*ã§ã—ã‚‡[ã†ãƒ¼]?|ãã‚Œã¯\s*(ãªã—|ç„¡ã—|ãªã„|ç„¡ã„)|(ã ã‚|ãƒ€ãƒ¡|é§„ç›®|ã‚ˆããªã„|è‰¯ããªã„|å¾®å¦™|è«–å¤–|ç„¡ç†|ã‚€ã‚Š|å´ä¸‹|åå¯¾|ä¸è¦|ã„ã‚‰ã‚“|ã„ã‚‰ãªã„|NG|ãƒœãƒ„|æ²¡)/i,
};

export function getDefaultLFs(): LF[] {
  const on = (name: string, label: Label, re: RegExp, weak = 1): LF => ({
    name, label, apply: (t) => (re.test(t) ? weak : 0),
  });

  return [
    on("lf_agree", "AG", RE.agree),
    on("lf_praise", "AG", RE.praise),
    on("lf_emotion", "EM", RE.emotion),
    on("lf_laugh_only", "EM", RE.laughOnly, 0.9),
    on("lf_chit", "CH", RE.chit, 0.7),
    on("lf_chit_head", "CH", RE.chitHead, 0.6),
    on("lf_question_tail", "Q", RE.question),
    on("lf_question_hint", "Q", RE.jaQuestionHints, 0.9),
    on("lf_kansai_q", "Q", RE.kansaiQ, 1.0),
    on("lf_negation", "NG", RE.neg, 1.0),
  ];
}
